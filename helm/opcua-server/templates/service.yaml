{{- /*
OPC UA Server Services
Split into separate services to allow different types (ClusterIP vs LoadBalancer)
and cleaner operational separation.
*/ -}}
{{- $fullName := include "emberburn.fullname" . -}}
{{- $labels := include "emberburn.labels" . -}}
{{- $selectorLabels := include "emberburn.selectorLabels" . -}}

{{- /* 1. OPC UA Service */ -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ $fullName }}-opcua
  labels:
    {{- $labels | nindent 4 }}
    app.kubernetes.io/component: opcua
  {{- with .Values.service.opcua.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  type: {{ .Values.service.opcua.type }}
  ports:
    - port: {{ .Values.service.opcua.port }}
      targetPort: opcua
      protocol: {{ .Values.service.opcua.protocol }}
      name: opcua
  selector:
    {{- $selectorLabels | nindent 4 }}

---

{{- /* 2. Web UI / REST API Service */ -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ $fullName }}-webui
  labels:
    {{- $labels | nindent 4 }}
    app.kubernetes.io/component: webui
  {{- with .Values.service.webui.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  type: {{ .Values.service.webui.type }}
  ports:
    - port: {{ .Values.service.webui.port }}
      targetPort: http
      protocol: {{ .Values.service.webui.protocol }}
      name: http
  selector:
    {{- $selectorLabels | nindent 4 }}

---

{{- /* 3. Prometheus Metrics Service */ -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ $fullName }}-metrics
  labels:
    {{- $labels | nindent 4 }}
    app.kubernetes.io/component: metrics
  {{- with .Values.service.prometheus.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  type: {{ .Values.service.prometheus.type }}
  ports:
    - port: {{ .Values.service.prometheus.port }}
      targetPort: metrics
      protocol: {{ .Values.service.prometheus.protocol }}
      name: metrics
  selector:
    {{- $selectorLabels | nindent 4 }}
