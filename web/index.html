<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmberBurn - OPC UA Industrial Gateway</title>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Recharts for graphs -->
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --flame-orange: #ff6b35;
            --flame-red: #ff4136;
            --ember-dark: #1a1a1a;
            --ember-gray: #2d2d2d;
            --smoke-gray: #4a4a4a;
            --ash-light: #e0e0e0;
            --fire-yellow: #ffd700;
            --success-green: #28a745;
            --warning-orange: #ff9500;
            --error-red: #dc3545;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--ember-gray);
            border-right: 2px solid var(--flame-orange);
            padding: 20px;
            overflow-y: auto;
        }
        
        .logo-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--ember-dark);
            border-radius: 10px;
            border: 1px solid var(--flame-orange);
        }
        
        .ascii-art {
            font-family: 'Courier New', monospace;
            font-size: 10px;
            line-height: 1;
            color: var(--flame-orange);
            margin-bottom: 10px;
            white-space: pre;
        }
        
        .tagline {
            color: var(--ash-light);
            font-size: 11px;
            margin-top: 10px;
            font-style: italic;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            padding: 12px 16px;
            margin: 8px 0;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-item:hover {
            background: var(--smoke-gray);
            transform: translateX(5px);
        }
        
        .nav-item.active {
            background: var(--flame-orange);
            color: var(--ember-dark);
            font-weight: bold;
        }
        
        .nav-icon {
            width: 20px;
            height: 20px;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .header {
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: var(--flame-orange);
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: var(--ash-light);
        }
        
        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: var(--ember-gray);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--smoke-gray);
            transition: all 0.3s;
        }
        
        .card:hover {
            border-color: var(--flame-orange);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
            transform: translateY(-2px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 18px;
            color: var(--ash-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--flame-orange);
            margin: 10px 0;
        }
        
        .card-subtitle {
            color: var(--smoke-gray);
            font-size: 14px;
        }
        
        /* Status Badge */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-active {
            background: var(--success-green);
            color: white;
        }
        
        .status-inactive {
            background: var(--smoke-gray);
            color: var(--ash-light);
        }
        
        .status-warning {
            background: var(--warning-orange);
            color: var(--ember-dark);
        }
        
        .status-critical {
            background: var(--error-red);
            color: white;
        }
        
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--flame-orange);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--flame-red);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.5);
        }
        
        .btn-secondary {
            background: var(--smoke-gray);
            color: var(--ash-light);
        }
        
        .btn-secondary:hover {
            background: var(--ember-dark);
        }
        
        .btn-success {
            background: var(--success-green);
            color: white;
        }
        
        .btn-danger {
            background: var(--error-red);
            color: white;
        }
        
        /* Table */
        .table-container {
            background: var(--ember-gray);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--smoke-gray);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: var(--ember-dark);
        }
        
        th {
            padding: 15px;
            text-align: left;
            color: var(--flame-orange);
            font-weight: bold;
            border-bottom: 2px solid var(--flame-orange);
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--smoke-gray);
        }
        
        tr:hover {
            background: var(--smoke-gray);
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--ash-light);
            font-weight: bold;
        }
        
        .form-input,
        .form-select {
            width: 100%;
            padding: 10px;
            background: var(--ember-dark);
            border: 1px solid var(--smoke-gray);
            border-radius: 6px;
            color: var(--ash-light);
            font-size: 14px;
        }
        
        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--flame-orange);
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--smoke-gray);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .toggle-switch.active {
            background: var(--success-green);
        }
        
        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .toggle-switch.active .toggle-slider {
            left: 33px;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background: var(--ember-gray);
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid var(--flame-orange);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 24px;
            color: var(--flame-orange);
        }
        
        .modal-close {
            cursor: pointer;
            font-size: 28px;
            color: var(--ash-light);
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: var(--flame-orange);
        }
        
        /* Pulse Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--smoke-gray);
            border-top: 3px solid var(--flame-orange);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--ember-dark);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--flame-orange);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--flame-red);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ASCII Art Components
        const FireballLogo = () => (
            <div className="ascii-art">
{`    _____ _           _           _ _ 
   |  ___(_)_ __ ___| |__   __ _| | |
   | |_  | | '__/ _ \\ '_ \\ / _\` | | |
   |  _| | | | |  __/ |_) | (_| | | |
   |_|   |_|_|  \\___|_.__/ \\__,_|_|_|
                                      
   ___           _           _        _           
  |_ _|_ __   __| |_   _ ___| |_ _ __(_) ___  ___ 
   | || '_ \\ / _\` | | | / __| __| '__| |/ _ \\/ __|
   | || | | | (_| | |_| \\__ \\ |_| |  | |  __/\\__ \\
  |___|_| |_|\\__,_|\\__,_|___/\\__|_|  |_|\\___||___/`}
            </div>
        );

        const EmberBurnLogo = () => (
            <div className="ascii-art" style={{fontSize: '12px', color: '#ffd700'}}>
{`  _____ __  __ ____  _____ ____  ____  _   _ ____  _   _ 
 | ____|  \\/  | __ )| ____|  _ \\| __ )| | | |  _ \\| \\ | |
 |  _| | |\\/| |  _ \\|  _| | |_) |  _ \\| | | | |_) |  \\| |
 | |___| |  | | |_) | |___|  _ <| |_) | |_| |  _ <| |\\  |
 |_____|_|  |_|____/|_____|_| \\_\\____/ \\___/|_| \\_\\_| \\_|`}
            </div>
        );

        // Main App Component
        function App() {
            const [currentView, setCurrentView] = useState('dashboard');
            const [tags, setTags] = useState([]);
            const [publishers, setPublishers] = useState([]);
            const [alarms, setAlarms] = useState([]);
            const [loading, setLoading] = useState(true);

            // Fetch data on mount and every 2 seconds
            useEffect(() => {
                fetchData();
                const interval = setInterval(fetchData, 2000);
                return () => clearInterval(interval);
            }, []);

            const fetchData = async () => {
                try {
                    // Fetch tags from REST API
                    const tagsRes = await fetch('http://localhost:5000/api/tags');
                    const tagsData = await tagsRes.json();
                    setTags(Object.entries(tagsData.tags || {}).map(([name, data]) => ({
                        name,
                        value: data.value,
                        timestamp: data.timestamp
                    })));

                    // Fetch publishers status
                    const pubRes = await fetch('http://localhost:5000/api/publishers');
                    if (pubRes.ok) {
                        const pubData = await pubRes.json();
                        setPublishers(pubData.publishers || []);
                    }

                    // Fetch alarms
                    const alarmsRes = await fetch('http://localhost:5000/api/alarms/active');
                    if (alarmsRes.ok) {
                        const alarmsData = await alarmsRes.json();
                        setAlarms(alarmsData.alarms || []);
                    }

                    setLoading(false);
                } catch (error) {
                    console.error('Error fetching data:', error);
                    setLoading(false);
                }
            };

            return (
                <div className="app-container">
                    <Sidebar currentView={currentView} setCurrentView={setCurrentView} />
                    <div className="main-content">
                        {loading ? (
                            <div className="spinner"></div>
                        ) : (
                            <>
                                {currentView === 'dashboard' && <Dashboard tags={tags} publishers={publishers} alarms={alarms} />}
                                {currentView === 'tags' && <TagsView tags={tags} fetchData={fetchData} />}
                                {currentView === 'publishers' && <PublishersView publishers={publishers} fetchData={fetchData} />}
                                {currentView === 'alarms' && <AlarmsView alarms={alarms} />}
                                {currentView === 'config' && <ConfigView />}
                            </>
                        )}
                    </div>
                </div>
            );
        }

        // Sidebar Component
        function Sidebar({ currentView, setCurrentView }) {
            const menuItems = [
                { id: 'dashboard', label: 'Dashboard', icon: 'üìä' },
                { id: 'tags', label: 'Tag Monitor', icon: 'üè∑Ô∏è' },
                { id: 'publishers', label: 'Publishers', icon: 'üì°' },
                { id: 'alarms', label: 'Alarms', icon: 'üö®' },
                { id: 'config', label: 'Configuration', icon: '‚öôÔ∏è' }
            ];

            return (
                <div className="sidebar">
                    <div className="logo-section">
                        <EmberBurnLogo />
                        <FireballLogo />
                        <div className="tagline">Industrial IoT Gateway Platform</div>
                    </div>

                    <ul className="nav-menu">
                        {menuItems.map(item => (
                            <li
                                key={item.id}
                                className={`nav-item ${currentView === item.id ? 'active' : ''}`}
                                onClick={() => setCurrentView(item.id)}
                            >
                                <span className="nav-icon">{item.icon}</span>
                                {item.label}
                            </li>
                        ))}
                    </ul>

                    <div style={{marginTop: 'auto', paddingTop: '30px', fontSize: '12px', color: '#666', textAlign: 'center'}}>
                        <div>12 Protocols Active</div>
                        <div style={{marginTop: '10px'}}>¬© 2026 Fireball Industries</div>
                        <div style={{marginTop: '5px', fontStyle: 'italic'}}>By Patrick Ryan, CTO</div>
                    </div>
                </div>
            );
        }

        // Dashboard View
        function Dashboard({ tags, publishers, alarms }) {
            const activePublishers = publishers.filter(p => p.enabled).length;
            const activeTags = tags.length;
            const criticalAlarms = alarms.filter(a => a.priority === 'CRITICAL').length;

            return (
                <div>
                    <div className="header">
                        <h1>üî• EmberBurn Dashboard</h1>
                        <p>Real-time Industrial IoT Monitoring & Control</p>
                    </div>

                    <div className="card-grid">
                        <div className="card">
                            <div className="card-header">
                                <div className="card-title">
                                    <span>üè∑Ô∏è</span>
                                    Active Tags
                                </div>
                            </div>
                            <div className="card-value">{activeTags}</div>
                            <div className="card-subtitle">Real-time monitoring</div>
                        </div>

                        <div className="card">
                            <div className="card-header">
                                <div className="card-title">
                                    <span>üì°</span>
                                    Publishers
                                </div>
                            </div>
                            <div className="card-value">{activePublishers} / {publishers.length}</div>
                            <div className="card-subtitle">Protocols enabled</div>
                        </div>

                        <div className="card">
                            <div className="card-header">
                                <div className="card-title">
                                    <span>üö®</span>
                                    Active Alarms
                                </div>
                            </div>
                            <div className="card-value" style={{color: criticalAlarms > 0 ? '#dc3545' : '#28a745'}}>
                                {alarms.length}
                            </div>
                            <div className="card-subtitle">{criticalAlarms} critical</div>
                        </div>
                    </div>

                    <div style={{marginTop: '30px'}}>
                        <h2 style={{color: '#ff6b35', marginBottom: '20px'}}>Live Tag Values</h2>
                        <div className="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tag Name</th>
                                        <th>Current Value</th>
                                        <th>Last Update</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {tags.slice(0, 10).map((tag, idx) => (
                                        <tr key={idx}>
                                            <td style={{fontWeight: 'bold'}}>{tag.name}</td>
                                            <td style={{color: '#ffd700', fontSize: '18px'}}>{tag.value}</td>
                                            <td>{new Date(tag.timestamp * 1000).toLocaleTimeString()}</td>
                                            <td>
                                                <span className="status-badge status-active pulse">LIVE</span>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        }

        // Tags View
        function TagsView({ tags }) {
            return (
                <div>
                    <div className="header">
                        <h1>üè∑Ô∏è Tag Monitor</h1>
                        <p>Real-time tag values and monitoring</p>
                    </div>

                    <div className="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Tag Name</th>
                                    <th>Value</th>
                                    <th>Type</th>
                                    <th>Last Update</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {tags.map((tag, idx) => (
                                    <tr key={idx}>
                                        <td style={{fontWeight: 'bold'}}>{tag.name}</td>
                                        <td style={{color: '#ffd700', fontSize: '18px'}}>{tag.value}</td>
                                        <td>{typeof tag.value}</td>
                                        <td>{new Date(tag.timestamp * 1000).toLocaleString()}</td>
                                        <td>
                                            <button className="btn btn-secondary" style={{padding: '5px 10px', fontSize: '12px'}}>
                                                üìä History
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        // Publishers View
        function PublishersView({ publishers, fetchData }) {
            const togglePublisher = async (name) => {
                try {
                    await fetch(`http://localhost:5000/api/publishers/${name}/toggle`, { method: 'POST' });
                    fetchData();
                } catch (error) {
                    console.error('Error toggling publisher:', error);
                }
            };

            const protocolIcons = {
                'MQTT': 'üì®',
                'REST API': 'üåê',
                'GraphQL': 'üî∑',
                'Sparkplug B': '‚ö°',
                'Kafka': 'üéØ',
                'AMQP': 'üê∞',
                'WebSocket': 'üîå',
                'InfluxDB': 'üìä',
                'MODBUS TCP': 'üîß',
                'OPC UA Client': 'üîó',
                'Alarms': 'üö®'
            };

            return (
                <div>
                    <div className="header">
                        <h1>üì° Publishers</h1>
                        <p>Manage data publishing protocols</p>
                    </div>

                    <div className="card-grid">
                        {publishers.map((pub, idx) => (
                            <div className="card" key={idx}>
                                <div className="card-header">
                                    <div className="card-title">
                                        <span style={{fontSize: '24px'}}>{protocolIcons[pub.name] || 'üì°'}</span>
                                        {pub.name}
                                    </div>
                                    <span className={`status-badge ${pub.enabled ? 'status-active' : 'status-inactive'}`}>
                                        {pub.enabled ? 'ENABLED' : 'DISABLED'}
                                    </span>
                                </div>
                                <div style={{marginTop: '15px', fontSize: '14px', color: '#999'}}>
                                    {pub.description || 'Data publishing protocol'}
                                </div>
                                <div style={{marginTop: '15px', display: 'flex', gap: '10px'}}>
                                    <button 
                                        className={`btn ${pub.enabled ? 'btn-danger' : 'btn-success'}`}
                                        onClick={() => togglePublisher(pub.name)}
                                        style={{flex: 1}}
                                    >
                                        {pub.enabled ? '‚è∏Ô∏è Disable' : '‚ñ∂Ô∏è Enable'}
                                    </button>
                                    <button className="btn btn-secondary">‚öôÔ∏è Config</button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Alarms View
        function AlarmsView({ alarms }) {
            return (
                <div>
                    <div className="header">
                        <h1>üö® Alarms</h1>
                        <p>Active alarm monitoring</p>
                    </div>

                    {alarms.length === 0 ? (
                        <div className="card" style={{textAlign: 'center', padding: '40px'}}>
                            <div style={{fontSize: '48px', marginBottom: '20px'}}>‚úÖ</div>
                            <h2 style={{color: '#28a745'}}>All Systems Normal</h2>
                            <p style={{color: '#999', marginTop: '10px'}}>No active alarms</p>
                        </div>
                    ) : (
                        <div className="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Priority</th>
                                        <th>Alarm</th>
                                        <th>Tag</th>
                                        <th>Value</th>
                                        <th>Message</th>
                                        <th>Time</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {alarms.map((alarm, idx) => (
                                        <tr key={idx}>
                                            <td>
                                                <span className={`status-badge status-${alarm.priority.toLowerCase()}`}>
                                                    {alarm.priority}
                                                </span>
                                            </td>
                                            <td style={{fontWeight: 'bold'}}>{alarm.rule_name}</td>
                                            <td>{alarm.tag}</td>
                                            <td style={{color: '#ffd700'}}>{alarm.triggered_value}</td>
                                            <td>{alarm.message}</td>
                                            <td>{new Date(alarm.triggered_at * 1000).toLocaleString()}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );
        }

        // Config View
        function ConfigView() {
            return (
                <div>
                    <div className="header">
                        <h1>‚öôÔ∏è Configuration</h1>
                        <p>System settings and management</p>
                    </div>

                    <div className="card">
                        <h2 style={{color: '#ff6b35', marginBottom: '20px'}}>Server Information</h2>
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px'}}>
                            <div>
                                <strong>OPC UA Endpoint:</strong>
                                <div style={{color: '#999'}}>opc.tcp://0.0.0.0:4840/freeopcua/server/</div>
                            </div>
                            <div>
                                <strong>REST API:</strong>
                                <div style={{color: '#999'}}>http://localhost:5000/api/</div>
                            </div>
                            <div>
                                <strong>GraphQL API:</strong>
                                <div style={{color: '#999'}}>http://localhost:5002/graphql</div>
                            </div>
                            <div>
                                <strong>Platform:</strong>
                                <div style={{color: '#999'}}>EmberBurn v1.0</div>
                            </div>
                        </div>
                    </div>

                    <div className="card" style={{marginTop: '20px'}}>
                        <h2 style={{color: '#ff6b35', marginBottom: '20px'}}>Quick Actions</h2>
                        <div style={{display: 'flex', gap: '10px', flexWrap: 'wrap'}}>
                            <button className="btn btn-primary">üîÑ Restart Server</button>
                            <button className="btn btn-secondary">üì• Export Config</button>
                            <button className="btn btn-secondary">üì§ Import Config</button>
                            <button className="btn btn-secondary">üìä View Logs</button>
                        </div>
                    </div>
                </div>
            );
        }

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
